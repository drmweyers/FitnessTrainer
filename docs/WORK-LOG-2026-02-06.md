# EvoFitTrainer Work Log - February 5-6, 2026

## URGENT: UNCOMMITTED WORK IN PROGRESS

**There are uncommitted changes on the `master` branch.** The next developer MUST review and commit or revert these before starting new work.

### Uncommitted Changes (Phase 7 + Cleanup - NOT YET COMMITTED)

**New file created but untracked:**
- `app/api/dashboard/stats/route.ts` - Dashboard stats API endpoint (uses `$queryRaw`)

**Files modified (unstaged):**
- `app/dashboard/admin/page.tsx` - Wired to real API (was mock data)
- `app/dashboard/client/page.tsx` - Wired to real API (was mock data)
- `app/dashboard/trainer/page.tsx` - Wired to real API (was mock data)

**Files deleted (unstaged) - Dead/orphan pages removed:**
- `app/badges/` (4 pages) + `app/api/badges/route.ts` - Feature never built
- `app/levels/` (4 pages) - Feature never built
- `app/ecommerce/page.tsx` - Amazon clone, out of scope
- `app/recipe-books/` (2 pages) - Not in scope
- `app/meal-plans/create/page.tsx` - Not in scope
- `app/trainer-dashboard/page.tsx` - Duplicate of `app/dashboard/trainer/`
- `components/BadgeCard.tsx`, `components/BadgeList/index.tsx` - Orphaned
- `components/CategoryNav.tsx`, `components/Pagination.tsx`, `components/SearchBar.tsx` - Orphaned
- `components/RecipeBookGrid.tsx` - Orphaned
- `components/features/Badges/` (2 files) - Orphaned
- `components/features/Levels/` (4 files) - Orphaned
- `components/features/MealPlan/` (2 files) - Orphaned
- `components/features/RecipeLibrary/` (7 files) - Orphaned
- `data/mockRecipes.ts` - Orphaned mock data

**Was about to delete but interrupted:**
- `types/badge.ts` - Orphaned (no imports remain)
- `types/recipe.ts` - Orphaned (no imports remain)

---

## Committed Work (commit `18228a2`)

**Commit message:** `fix: consolidate src/ directory and wire frontend to real APIs`
**Files changed:** 304 files, +2,594 / -51,316 lines

### Phase 0 - Architecture Consolidation
- Moved all files from `src/` to root (251 files deleted from src/)
- Cleaned `tsconfig.json` - removed all `./src/*` fallback paths
- Fixed `next.config.js` - API rewrite now conditional (`NEXT_PUBLIC_USE_EXPRESS=true`)

### Phase 1 - Bug Fixes
- Exercise service: fixed `/exercises/categories` to `/exercises/filters` endpoint
- Exercise service: fixed multi-select filter bug (sends comma-separated values)
- Login pages: removed hardcoded `localhost` URLs, use relative `/api/` paths
- Analytics API client: fixed token key `authToken` to `accessToken` (3 occurrences)
- DailyWorkoutView, exercises/[type], clientConnectionService: `localhost` to `/api`

### Phase 2 - Auth Pages
- Created `app/auth/register/page.tsx` (full registration form)
- Created `app/auth/forgot-password/page.tsx` (email form)
- Created `app/api/auth/forgot-password/route.ts` (anti-enumeration pattern)
- `app/login/page.tsx` now redirects to `/auth/login`
- `app/register/page.tsx` now redirects to `/auth/register`

### Phase 3 - Navigation
- Sidebar rewritten: uses query params (`/clients?status=active`)
- Client dashboard: workout start button wired to `router.push`

### Phase 4 - API Routes Created
- `app/api/exercises/favorites/route.ts` (GET, POST, DELETE)
- `app/api/exercises/collections/route.ts` + `/[id]` + `/[id]/exercises`
- `app/api/analytics/measurements/` (POST, GET `/me`, PUT/DELETE `/[id]`)

### Phase 5 - Frontend Wiring
- Programs: ProgramList, ProgramBuilder, TemplateLibrary, BulkAssignment wired
- Workouts: page fetches real exercises, debounced search + pagination
- Clients: ClientList wired to `clientsApi.getClients()` with mapping adapter
- Analytics: wired to `analyticsApi` with new backend routes

### Phase 6 - Hooks & Dashboard Wiring
- `hooks/useFavorites.ts`: complete rewrite from localStorage mock to real `/api/exercises/favorites`
- `hooks/useCollections.ts`: complete rewrite from localStorage mock to real `/api/exercises/collections`
- Exercise detail page: add-to-collection dropdown wired to real API
- Favorites page: collections data populated from `useCollections`
- Collection detail page: `isFavorited` check wired to real `useFavorites` hook

---

## Architecture Overview

### Dual Prisma Schema Problem
- **Root `prisma/schema.prisma`** (minimal): Exercise, User, ExerciseFavorite, ExerciseCollection, CollectionExercise, ExerciseUsage, ExerciseSearchHistory
- **`backend/prisma/schema.prisma`** (full): All above + Program, ProgramWeek, ProgramWorkout, WorkoutSession, TrainerClient, UserProfile, UserMeasurement, etc.
- The Next.js app generates Prisma Client from the minimal schema
- Auth middleware queries `user.role`, `user.isVerified`, `user.deletedAt` which aren't in minimal schema (suppressed by `ignoreBuildErrors`)
- Dashboard stats API uses `prisma.$queryRaw` to bypass this limitation

### API Route Categories
1. **Prisma Direct** (working on Vercel): exercises, auth, analytics, favorites, collections, dashboard/stats
2. **Express Proxy** (requires Express at `localhost:4000`): 12 routes for programs + workouts
   - `app/api/programs/route.ts`, `app/api/programs/[id]/route.ts`, etc.
   - `app/api/workouts/route.ts`, `app/api/workouts/[id]/route.ts`, etc.
   - These proxy to `BACKEND_URL || 'http://localhost:4000/api'`

### Auth Pattern
- JWT stored as `accessToken` in localStorage
- API routes use `authenticate()` from `@/lib/middleware/auth`
- Frontend hooks use `getAuthHeaders()` pattern:
  ```typescript
  function getAuthHeaders(): HeadersInit {
    const token = typeof window !== 'undefined' ? localStorage.getItem('accessToken') : null
    return { 'Content-Type': 'application/json', ...(token && { Authorization: `Bearer ${token}` }) }
  }
  ```

---

## Remaining Work (Priority Order)

### HIGH PRIORITY
1. **Commit the uncommitted Phase 7 work** (dashboard wiring + dead page cleanup)
2. **Delete orphaned type files**: `types/badge.ts`, `types/recipe.ts`
3. **Fix 226 TypeScript errors** suppressed by `ignoreBuildErrors: true`
   - Many are from minimal Prisma schema missing fields (role, isVerified, etc.)
   - Consider expanding root schema or using backend schema for generation

### MEDIUM PRIORITY
4. **Convert 12 Express proxy routes to Prisma direct**
   - Requires either expanding root `prisma/schema.prisma` with Program/Workout models
   - Or using `prisma.$queryRaw` (like dashboard stats API does)
   - Affected routes: programs (CRUD + assign + duplicate + templates), workouts (CRUD + active + history + progress + complete + sets)
5. **Wire remaining dashboard data**
   - Activity feed system (no table exists yet)
   - Workout streak calculation
   - Program progress tracking on client dashboard

### LOW PRIORITY
6. **Clean up remaining orphaned components** - audit `components/` for unused files
7. **Exercise GIF database** (1.3GB) - not in git, needs hosting solution
8. **Epics 008-012** (Messaging, Scheduling, Payments, Mobile, Admin) - 0% complete

---

## Epic Status After All Work

| Epic | Feature | Status |
|------|---------|--------|
| 001 | User Profiles | ~75% |
| 002 | Authentication | 100% |
| 003 | Client Management | ~95% |
| 004 | Exercise Library | ~85% (hooks+API+UI all wired) |
| 005 | Program Builder | ~75% (frontend wired, backend proxy) |
| 006 | Workout Tracking | ~60% (builder + history wired) |
| 007 | Progress Analytics | ~60% (measurements API + page done) |
| 008-012 | Messaging, Scheduling, Payments, Mobile, Admin | 0% |
