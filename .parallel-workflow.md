# Multi-Agent Parallel Development Workflow

## Overview

This workflow enables multiple AI agents to work on different parts of the EvoFit codebase simultaneously using git worktrees, preventing conflicts and maximizing development velocity.

## Architecture

```
EvoFitTrainer/ (Main Repository)
‚îú‚îÄ‚îÄ master/                    (Main branch - integration ready)
‚îú‚îÄ‚îÄ worktrees/                 (Parallel development branches)
‚îÇ   ‚îú‚îÄ‚îÄ epic-004-exercises/   (Exercise Library implementation)
‚îÇ   ‚îú‚îÄ‚îÄ epic-005-programs/    (Program Builder implementation)
‚îÇ   ‚îú‚îÄ‚îÄ epic-006-workout/     (Workout Tracking implementation)
‚îÇ   ‚îî‚îÄ‚îÄ bugfixes/              (Bug fixes and hotfixes)
‚îî‚îÄ‚îÄ .git/
```

## Git Worktree Management

### Creating Worktrees

```bash
# Create worktree for Exercise Library development
git worktree add -b feature/epic-004-exercise-library .git/worktrees/epic-004-exercises

# Create worktree for Program Builder
git worktree add -b feature/epic-005-program-builder .git/worktrees/epic-005-programs

# Create worktree for Workout Tracking
git worktree add -b feature/epic-006-workout-tracking .git/worktrees/epic-006-workout

# List all worktrees
git worktree list
```

### Removing Worktrees

```bash
# Remove a worktree after merging
git worktree remove .git/worktrees/epic-004-exercises

# Or cleanup manually
git worktree remove <worktree-path>
```

## Agent Allocation Strategy

### Parallel Agents

| Agent | Worktree | Focus | Skills Required |
|-------|----------|-------|-----------------|
| **Agent 1: Exercise Library** | epic-004-exercises | Exercise data import, search UI, performance optimization | TypeScript, Next.js, API design |
| **Agent 2: Program Builder** | epic-005-programs | Program CRUD, exercise selection, templates | React, Prisma, business logic |
| **Agent 3: Workout Tracking** | epic-006-workout | Session logging, timers, offline support | Mobile-first, PWA, state management |
| **Agent 4: Testing & QA** | master | E2E tests, unit tests, quality assurance | Playwright, Jest, testing best practices |
| **Agent 5: Bug Fixes** | bugfixes | Hotfixes, critical issues, support | Full-stack, debugging |

### Agent Communication Protocol

**Important**: Agents work in ISOLATED worktrees and communicate via:
1. **Shared Interfaces**: API contracts and type definitions
2. **Integration Points**: Well-defined merge points
3. **Schema Changes**: Coordinated through `master` branch
4. **Code Reviews**: PR-based validation before merging

## Workflow Process

### Phase 1: Planning (Master Branch)

1. Define epic scope and acceptance criteria
2. Create feature branches from master
3. Set up shared type definitions
4. Document API contracts

```bash
# On master branch
git checkout master
git pull

# Define shared types in shared/types/
# Define API contracts in backend/src/shared/
```

### Phase 2: Parallel Development (Worktrees)

```bash
# Agent 1: Exercise Library
cd .git/worktrees/epic-004-exercises
git checkout feature/epic-004-exercise-library

# Agent 2: Program Builder
cd .git/worktrees/epic-005-programs
git checkout feature/epic-005-program-builder

# Agent 3: Workout Tracking
cd .git/worktrees/epic-006-workout
git checkout feature/epic-006-workout-tracking
```

### Phase 3: Integration (Master Branch)

```bash
# Merge completed features to master
git checkout master

# Merge Exercise Library
git merge feature/epic-004-exercise-library --no-ff

# Merge Program Builder
git merge feature/epic-005-program-builder --no-ff

# Merge Workout Tracking
git merge feature/epic-006-workout-tracking --no-ff
```

### Phase 4: Testing & QA (Master Branch)

```bash
# Run full test suite
npm test
npm run test:e2e

# Deploy to staging
git push origin master
```

## Shared Resources

### Type Definitions

```typescript
// shared/types/exercise.ts
export interface Exercise {
  id: string;
  name: string;
  gifUrl: string;
  bodyPart: string;
  equipment: string;
  difficulty: 'beginner' | 'intermediate' | 'advanced';
}

// shared/types/program.ts
export interface Program {
  id: string;
  name: string;
  exercises: Exercise[];
}

// shared/types/workout.ts
export interface WorkoutSession {
  id: string;
  programId: string;
  exercises: Exercise[];
}
```

### API Contracts

```typescript
// Backend API routes (defined in master first)
// /api/exercises - Managed by Agent 1
// /api/programs - Managed by Agent 2
// /api/workouts - Managed by Agent 3
```

## Conflict Resolution

### Preventing Conflicts

1. **Separate Schemas**: Each epic works on different database tables
2. **Shared Types**: Common types defined in `shared/` directory
3. **API Contracts**: RESTful APIs with clear ownership
4. **Regular Syncs**: Frequent merging from master to feature branches

### Resolving Conflicts

```bash
# Sync master changes to feature branch
cd .git/worktrees/epic-004-exercises
git fetch origin master:feature/epic-004-exercise-library
git rebase master

# Resolve conflicts and continue
git add .
git rebase --continue
```

## Starting Parallel Development

### Quick Start Script

```bash
#!/bin/bash
# setup-parallel-workflow.sh

echo "üöÄ Setting up EvoFit Parallel Development Workflow..."

# Create worktrees directory
mkdir -p .git/worktrees

# Create feature branches and worktrees
git worktree add -b feature/epic-004-exercise-library .git/worktrees/epic-004-exercises
git worktree add -b feature/epic-005-program-builder .git/worktrees/epic-005-programs
git worktree add -b feature/epic-006-workout-tracking .git/worktrees/epic-006-workout

echo "‚úÖ Worktrees created"
echo "üìã Git worktree list:"
git worktree list

echo "üéØ Ready for parallel agent assignment!"
```

## Agent Task Templates

### Agent 1: Exercise Library Task

```
You are working on Epic 004: Exercise Library
Worktree: .git/worktrees/epic-004-exercises
Branch: feature/epic-004-exercise-library

Your tasks:
1. Import 1,324 exercises from exerciseDB directory
2. Create Exercise API endpoints (GET, POST, PUT, DELETE)
3. Build exercise browsing UI with search/filtering
4. Implement exercise detail pages with GIF support
5. Add caching and performance optimization

Constraints:
- Use shared types from shared/types/exercise.ts
- Follow RESTful API conventions
- Ensure mobile responsiveness
- Test with 1000+ exercises
```

### Agent 2: Program Builder Task

```
You are working on Epic 005: Program Builder
Worktree: .git/worktrees/epic-005-programs
Branch: feature/epic-005-program-builder

Your tasks:
1. Create Program API endpoints
2. Build program creation interface
3. Implement exercise selection from Exercise Library
4. Add program templates system
5. Enable client program assignment

Constraints:
- Use Exercise API from Agent 1's endpoints
- Use shared types from shared/types/program.ts
- Support drag-and-drop exercise ordering
- Include program preview functionality
```

### Agent 3: Workout Tracking Task

```
You are working on Epic 006: Workout Tracking
Worktree: .git/worktrees/epic-006-workout
Branch: feature/epic-006-workout-tracking

Your tasks:
1. Create Workout Session API endpoints
2. Build workout logging interface
3. Implement rest timer functionality
4. Add offline support with service worker
5. Create progress visualization

Constraints:
- Integrate with Program API from Agent 2
- Use shared types from shared/types/workout.ts
- Support background execution
- Implement data synchronization
```

## Superpowers Integration

All agents use Superpowers methodology by default:

| Agent Activity | Superpowers Skill |
|----------------|-------------------|
| Starting new feature | `@subagent-driven-development` |
| Fixing bugs | `@systematic-debugging` |
| Writing tests | `@test-driven-development` |
| Code review | `@requesting-code-review` |
| Completion check | `@verification-before-completion` |

## Monitoring & Coordination

### Status Dashboard

```bash
# Check all worktree status
git worktree list

# Check unmerged changes
git log --graph --oneline --all

# Check branch status
git branch -vv
```

### Coordination Meeting Points

1. **Daily**: Sync master branch to all worktrees
2. **Every 2 Days**: Code review and integration testing
3. **Weekly**: Feature completion and merge to master
4. **Bi-Weekly**: Full testing and deployment

## Best Practices

### DO ‚úÖ
- Work in isolated worktrees
- Sync from master regularly
- Use shared type definitions
- Follow API contracts
- Write tests in your worktree
- Create PRs for review
- Document your changes

### DON'T ‚ùå
- Work directly on master branch (except for merges)
- Modify shared interfaces without coordination
- Push directly to main without PR
- Ignore conflicts - resolve them early
- Skip testing in your worktree
- Modify another agent's files without permission

## Troubleshooting

### Worktree Issues

```bash
# List all worktrees
git worktree list

# Remove problematic worktree
git worktree remove <path>

# Force remove (if needed)
git worktree remove --force <path>

# Recreate worktree
git worktree add -b <branch> <path>
```

### Merge Conflicts

```bash
# Abort merge and start over
git merge --abort

# Rebase instead of merge
git rebase master

# Use merge tool
git mergetool
```

## Success Criteria

‚úÖ **Workflow is successful when**:
- Multiple agents can work simultaneously without conflicts
- Features integrate cleanly on master branch
- All tests pass after integration
- Deployment is successful
- No regressions in existing functionality
- Documentation is updated

---

**Last Updated**: 2025-01-30
**Version**: 1.0
**Status**: ‚úÖ Active
