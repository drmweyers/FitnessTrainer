// Minimal Prisma schema for Next.js API routes
// Full schema is in backend/prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum DifficultyLevel {
  beginner
  intermediate
  advanced
}

model Exercise {
  id                String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  exerciseId        String       @unique @map("exercise_id") @db.VarChar(255)
  name              String       @db.VarChar(255)
  gifUrl            String       @map("gif_url") @db.Text
  bodyPart          String       @map("body_part") @db.VarChar(100)
  equipment         String       @db.VarChar(100)
  targetMuscle      String       @map("target_muscle") @db.VarChar(100)
  secondaryMuscles String[]      @default([]) @map("secondary_muscles")
  instructions      String[]      @default([])
  difficulty        DifficultyLevel
  searchVector      String?      @map("search_vector")
  isActive          Boolean      @default(true) @map("is_active")
  createdAt         DateTime     @default(now()) @map("created_at")
  updatedAt         DateTime?    @updatedAt @map("updated_at")

  // Relations
  favorites       ExerciseFavorite[]       @relation("ExerciseFavorites")
  collections      CollectionExercise[]    @relation("ExerciseCollections")
  usage           ExerciseUsage[]          @relation("ExerciseUsage")

  @@map("exercises")
}

model ExerciseFavorite {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId      String   @map("user_id") @db.Uuid
  exerciseId  String   @map("exercise_id") @db.Uuid
  favoritedAt DateTime @default(now()) @map("favorited_at")

  // Relations
  user     User     @relation("UserExerciseFavorites", fields: [userId], references: [id], onDelete: Cascade)
  exercise Exercise @relation("ExerciseFavorites", fields: [exerciseId], references: [id], onDelete: Cascade)

  @@unique([userId, exerciseId])
  @@map("exercise_favorites")
}

model ExerciseCollection {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId      String   @map("user_id") @db.Uuid
  name        String   @db.VarChar(255)
  description String?  @db.Text
  isPublic    Boolean  @default(false) @map("is_public")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime? @updatedAt @map("updated_at")

  // Relations
  user      User                 @relation("UserExerciseCollections", fields: [userId], references: [id], onDelete: Cascade)
  exercises CollectionExercise[] @relation("ExerciseCollections")

  @@map("exercise_collections")
}

model CollectionExercise {
  id           String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  collectionId String   @map("collection_id") @db.Uuid
  exerciseId   String   @map("exercise_id") @db.Uuid
  position     Int      @default(0)
  addedAt      DateTime @default(now()) @map("added_at")

  // Relations
  collection ExerciseCollection @relation("ExerciseCollections", fields: [collectionId], references: [id], onDelete: Cascade)
  exercise    Exercise           @relation("ExerciseCollections", fields: [exerciseId], references: [id], onDelete: Cascade)

  @@unique([collectionId, exerciseId])
  @@map("collection_exercises")
}

model ExerciseUsage {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId      String   @map("user_id") @db.Uuid
  exerciseId  String   @map("exercise_id") @db.Uuid
  context     String   @db.VarChar(50)
  usedAt      DateTime @default(now()) @map("used_at")

  // Relations
  user     User     @relation("UserExerciseUsage", fields: [userId], references: [id], onDelete: Cascade)
  exercise Exercise @relation("ExerciseUsage", fields: [exerciseId], references: [id], onDelete: Cascade)

  @@map("exercise_usage")
}

model ExerciseSearchHistory {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId      String   @map("user_id") @db.Uuid
  searchQuery String   @map("search_query") @db.VarChar(255)
  filters     Json?
  resultCount Int      @map("result_count")
  createdAt   DateTime @default(now()) @map("created_at")

  // Relations
  user User @relation("UserExerciseSearchHistory", fields: [userId], references: [id], onDelete: Cascade)

  @@map("exercise_search_history")
}

model User {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email     String   @unique @db.VarChar(255)
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime? @updatedAt @map("updated_at")

  // Relations
  favorites    ExerciseFavorite[]    @relation("UserExerciseFavorites")
  collections  ExerciseCollection[]  @relation("UserExerciseCollections")
  usage        ExerciseUsage[]       @relation("UserExerciseUsage")
  searchHistory ExerciseSearchHistory[] @relation("UserExerciseSearchHistory")

  @@map("users")
}
